/*
 * traffic_light.c
 *
 *  Created on: Sep 28, 2023
 *      Author: Windows
 */

#include "traffic_ligh.h"

const int red_counter = 5;
const int green_counter = 3;
const int yellow_counter = 2;

int counter = red_counter;
int light_mode = 0;
void traffic_light(){
	switch (light_mode){
	case 0:
			//horizontal
			HAL_GPIO_WritePin(PA1_GPIO_Port, PA1_Pin, RESET);
			HAL_GPIO_WritePin(PA2_GPIO_Port, PA2_Pin, SET);
			HAL_GPIO_WritePin(PA3_GPIO_Port, PA3_Pin, SET);
			//vertical
			HAL_GPIO_WritePin(PA4_GPIO_Port, PA4_Pin, SET);
			HAL_GPIO_WritePin(PA5_GPIO_Port, PA5_Pin, SET);
			HAL_GPIO_WritePin(PA6_GPIO_Port, PA6_Pin, RESET);
			updateClockBuffer_horizontal(counter);
			updateClockBuffer_vertical((int)(counter-yellow_counter));
			if(counter == yellow_counter){
				light_mode = 1;
			}
			break;
		case 1:
			//horizontal
			HAL_GPIO_WritePin(PA1_GPIO_Port, PA1_Pin, RESET);
			HAL_GPIO_WritePin(PA2_GPIO_Port, PA2_Pin, SET);
			HAL_GPIO_WritePin(PA3_GPIO_Port, PA3_Pin, SET);
			//vertical
			HAL_GPIO_WritePin(PA4_GPIO_Port, PA4_Pin, SET);
			HAL_GPIO_WritePin(PA5_GPIO_Port, PA5_Pin, RESET);
			HAL_GPIO_WritePin(PA6_GPIO_Port, PA6_Pin, SET);
			updateClockBuffer_horizontal(counter);
			updateClockBuffer_vertical(counter);
			if(counter == 0){
				counter = green_counter;
				light_mode = 2;
			}
			break;
		case 2:
			//horizontal
			HAL_GPIO_WritePin(PA1_GPIO_Port, PA1_Pin, SET);
			HAL_GPIO_WritePin(PA2_GPIO_Port, PA2_Pin, SET);
			HAL_GPIO_WritePin(PA3_GPIO_Port, PA3_Pin, RESET);
			//vertical
			HAL_GPIO_WritePin(PA4_GPIO_Port, PA4_Pin, RESET);
			HAL_GPIO_WritePin(PA5_GPIO_Port, PA5_Pin, SET);
			HAL_GPIO_WritePin(PA6_GPIO_Port, PA6_Pin, SET);
			updateClockBuffer_horizontal(counter);
			updateClockBuffer_vertical((int)(counter+yellow_counter));
			if(counter == 0){
				counter = yellow_counter;
				light_mode = 3;
			}
			break;
		case 3:
			//horizontal
			HAL_GPIO_WritePin(PA1_GPIO_Port, PA1_Pin, SET);
			HAL_GPIO_WritePin(PA2_GPIO_Port, PA2_Pin, RESET);
			HAL_GPIO_WritePin(PA3_GPIO_Port, PA3_Pin, SET);
			//vertical
			HAL_GPIO_WritePin(PA4_GPIO_Port, PA4_Pin, RESET);
			HAL_GPIO_WritePin(PA5_GPIO_Port, PA5_Pin, SET);
			HAL_GPIO_WritePin(PA6_GPIO_Port, PA6_Pin, SET);
			updateClockBuffer_horizontal(counter);
			updateClockBuffer_vertical(counter);
			if(counter == 0){
				counter = red_counter;
				light_mode = 0;
			}
			break;
	}
}
